高可用的存储架构：数据集群、数据分区

一、数据集群
    主备、主从、主主架构本质上都有一个隐含的假设：主机能够存储所有数据，但主机本身存储和处理能力肯定有极限的。

    集群就是多台机器组合在一起形成一个统一的系统，这里的“多台”，数量至少是3台。
根据集群中机器承担的不同角色来划分，集群可以分为两类：数据集中、数据分散集群。

1、数据集中集群
数据集中集群为1主多备或者1主多从。
架构的逻辑关系：
客户端->主机（->：读&写）
主机->备机1（->：数据复制）
主机->备机2（->：数据复制）
主机->备机3（->：数据复制）
由于集群中的服务器数量更多，导致复杂度整体更高一些，具体体现：
（1）主机如何将数据复制给备机
（2）备机如何检测主机状态
（3）主机故障后，如何决定新的主机
目前开源的数据集中集群以zookeeper为典型，通过ZAB算法来解决上面几个问题。但ZAB算法的复杂度很高。

2、数据分散集群
数据分散集群指多个服务器组成一个集群，每台服务器都会负责存储一部分数据；同时为提升硬件利用率，每台服务器又会备份一部分数据。

数据分散集群的复杂点：如何将数据分配道不同的服务器上，算法需要考虑这些设计点：
（1）均衡性
（2）容错性
（3）可伸缩性

数据分散集群和数据集群的不同点在于：数据分散集群中的每台服务器都可以处理读写请求，因此不存在数据集中集群中负责写的主机那样的角色。
在数据分散集群中，必须有一个角色来负责执行数据分配算法，这个角色可以是一台独立的一台服务器，也可以是集群自己选举出的一台服务器。

Hadoop的实现就是独立的服务器负责数据分区的分配，这台服务器叫作namenode。
elasticsearch：集群通过选举一台服务器来做数据分区的分配，叫作master node。

数据集中集群架构中，客户端智能将数据写到主机，数据分散集群架构中，客户端可以想任意服务器中读写数据。

二、数据分区
基于地理级别的故障来设计高可用架构。
数据分区指将数据按照一定的规则进行分区，不同分区分布在不同的地理位置上，每个分区存储一部分数据，通过这种方式来规避地理级别的故障所照成的巨大影响。
设计一个良好的数据分区架构，需要从以下几方面考虑：
1、数据量
数据量的大小直接决定了分区的规则复杂度。
2、分区规则
分区规则需要综合考虑业务范围、成本等因素。
通常情况下，洲际分区主要用于面向不同大洲提供服务，由于跨洲通讯的网络延迟已经大到不适合提供在线服务了，因此洲际间的数据中心可以不互通或者仅仅作为备份；国家分区主要用于面向不同国家的用户提供服务，不同国家有不同语言、法律、业务等，国家间的分区一般仅作为备份；城市分区由于都在用一个国家或者地区内，网络延迟较低，业务相似，分区同时对外提供服务，可以满足业务异地多活之类的需求。
3、复制规则
常见的分区复制规则有三种：集中式、互备式和独立式。
（1）集中式：指存在一个总的备份中心，所有的分袂都将数据备份到备份中心。
优缺点：
1）设计简单，各分区之间并无直接联系，可以做到互不影响。
2）扩展容易。
3）成本较高。
（2）互备式：指每个分区备份另外一个分区的数据。
优缺点：
1）设计比较复杂。
2）扩展性不好。
3）成本低。
（3）独立式：指每个分区自己有独立的备份中心。
注意，各个分区的备份并不和原来的分区在一个地方。主要目的是规避统称或者相同地理位置同时发生灾难性故障的极端情况。
优缺点：
1）设计简单，各分区互不影响。
2）扩展容易。
3）成本高。
